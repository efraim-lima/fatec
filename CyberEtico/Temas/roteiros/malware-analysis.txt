O processo de analisar a presença de um malware parte da compreensão de que um malware atua promovendo sua persistencia no sistema em forma de tarefas, serviços e/ou processos. 

Para detectarmos um malware, então, precisamos saber analisar os pormenores destes elementos do sistema. 

Vamos ver quais são os meios?

Para windows precisamos primeiro baixar o sysinternals suite.

Porcurar por Process Explorer, funciona como o Task Manager, e procurar por processos que estejam deixando o sistema busy

Em seguida analisar startup programs, ou programas de inicialização, mas malwares podem ester escondidos no sistema (por eemlo em drivers do sistema e o caminho para analisar a presença de um malware passará para um processo mais avançado, por exemplo, analisando o Autoruns no Sysinternals Suite (analisar os registros do sistema separando por Logon e procurar por aplicações que tenham localizações, executaveis ou publishers suspeitos).

No linux podemos procurar por serviços suspeitos usando os comandos crontab -l e systemctl list-units --type=service.

Outro ponto que pode ser feito é analisar os processos através do Process Monitor dentro de Sysinternal Utils e analisar quando o processo inicia, o que faz, o caminho do processo, e quando conclui sua atividade. Importante analisar os prcessos que ocorrem no registry, no filesystem, na internet, nos processos. Uma boa prática é enonctrar algo feito no sistema que aparentemente não está funcionando, iniciar a captura dos processos e analisar o que ocorre a partir da ação tomada.

Ja no Linux, a tarefa de encontrar arquivos que foram abertos e os processos que os abriram é usando o comando sudo lsof ou então sudo strace -p <PID>. Gosto muito de usar também o sudo iotop para encontrar processos que estejam fazendo entrada e saída de ativos suspeitos assim como o glances.

Outro ponto que pode ocorrer é que as funções maliciosas podem estar em algum driver do sistema, basta analisar no Autoruns no setor de Services avaliando por elementos que podem soar como suspeitos para nos. A partir deste ponto podemos seguir o executavel ou dll e analisar com o virus total ou outra ferramenta equivalente assim como o Intezer Analyze.

Para analisar drivers no sistema Linux podemos usar o comando lsmod e procurar por drivers suspeitos.

Outro ponto para procurar é analisando os schedulers de tarefas, dentro do windows está em computer management > task scheduler. Lá analisaresmos quais são as tasks que tem tempo específico para iniciar (sem ser junto com o sistema) e analisar automações, podem ser indicadores de malwares e C2.

Mais um processo para analizar: rede.
Quando temos uma intrusão no sistema geralmente o atacante fará a exfiltração de dados do dispositivo para um servidor remoto, ou então estabelecerá um processo de C2 (Command & Control). Mas este processo deixará rastros. Caso não encontramos nada anteriormente (ou encontramos também rsrs) vale ape na voltarmos para o Process Explorer e procurar por conexões suspeitas entre os processos (e seu uso de CPU, que pode ser um indicativo de malware no sistema). Encontrando um processo suspeito basta entrar em suas propriedades e analisar seus IPs na seção TCP/IP, depois analisaremos os IPs e portas que o processo está usando (lembre de aconar o resolver address).

No Linux o equivalente é o comando htop ou, para uma visão mais detalhada podemos usar o ps aux.

Após isso, precisamos ter uma melhor visão do sistema, basta irmos em TCP View dentro do Sysinternals Utils e analisar pelos endereços remotos (Remote Address), dessa forma encontraremos possíveis IPs de processos suspeitos, então basta analisar o whois daqueles IPs para enonctrar possíveis indicadores de dominios suspeitos. Por fim, basta irmos no Intezer Analyze e pesquisar pelo processo e também pela região do IP.

No Linux o equivalente é o comando sudo ss -tuln (ou seus parentes), para monitorar a rede em tempo real podemos uisar o comando sudo nload -m.



Comandos no Linux para o tmux:
watch -n 1 ss -tuln #semelhante ao TCP View
sudo iotop #para analisar inputs e outputs no sistema
journalclt -fxe #equivalente ao Process Monitor
sudo nload -m #aqui teremos um complemento ao ss



